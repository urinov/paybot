<% layout('admin/layout') -%>
<h1>Payments</h1>
<form method="get" class="filters">
  <label>Oy (YYYY-MM) <input type="text" name="month" value="<%= month || '' %>" placeholder="2025-09"/></label>
  <button>Filter</button>
  <a class="btn" href="/admin/payments?<%= `month=${encodeURIComponent(month||'')}&export=csv` %>">CSV</a>
</form>

<div class="table-wrap">
<table>
  <thead>
    <tr><th>order_id</th><th>chat_id</th><th>provider</th><th>amount (so'm)</th><th>paid_at</th></tr>
  </thead>
  <tbody>
  <% rows.forEach(r => { %>
    <tr>
      <td><%= r.order_id %></td>
      <td><%= r.chat_id %></td>
      <td><%= r.provider %></td>
      <td><%= (r.amount/100).toLocaleString('uz-UZ') %></td>
      <td><small><%= r.paid_at?.toISOString?.() || r.paid_at %></small></td>
    </tr>
  <% }) %>
  </tbody>
</table>
</div>
